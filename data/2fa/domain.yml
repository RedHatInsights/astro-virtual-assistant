version: "3.1"

intents:
  - intent_enable_2fa
  - intent_enable_2fa_personal
  - intent_enable_2fa_org_admin_info
  - intent_individual_2fa_form_redirect
  - intent_enable_2fa_org_admin_setup
  - intent_dispatch_action_enable_org_2fa

entities: []

slots:
  org_or_account:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: form_enable_2fa
            requested_slot: org_or_account
  enable_2fa_continue:
    type: bool
    influence_conversation: true
    mappings:
      - type: from_intent
        value: true
        intent: intent_core_yes
        conditions: &enable_2fa_continue
          - active_loop: form_enable_2fa
            requested_slot: enable_2fa_continue
      - type: from_intent
        value: false
        intent: intent_core_no
        conditions: *enable_2fa_continue

actions:
  - action_enable_2fa_form_prefill
  - action_enable_2fa
  - validate_form_enable_2fa

forms:
  form_enable_2fa:
    required_slots:
      - org_or_account
      - enable_2fa_continue

responses:
  utter_ask_form_enable_2fa_org_or_account:
    - text: "It looks like you're an Org Admin. Do you want to enable two-factor authenticaiton for yourself or your entire org?"
      buttons:
        - title: Enable two-factor authentication for my account only
          payload: personal
        - title: Enable two-factor authentication for my org
          payload: org
  utter_enable_2fa_individual_1:
    - text: "I can provide information on how to set up two factor authentication for your personal account."
  utter_enable_2fa_individual_2:
    - text: |
        Here is how the process works:
        1. I will open a link to sso.redhat.com for you.
        2. In that page, there will be a section named **Two-factor authentication**.
        3. In that section, there is a button named **Set up Authenticator application**.
        4. Once you click that button, you will be asked to reauthenticate.
        5. After you reauthenticate, you will be redirected to a form to set up two-factor authentication.
  utter_ask_form_enable_2fa_enable_2fa_continue:
    - text: "Do you wish to continue?"
      buttons:
        - title: Yes
          payload: /intent_core_yes
        - title: No
          payload: /intent_core_no
  utter_individual_2fa_form_redirect:
    - text: "Ok, I will open that page in a new tab for you."
      custom:
        type: command
        command: redirect
        params:
          url: https://sso.redhat.com/auth/realms/redhat-external/account/#/account-security/signing-in
  utter_enable_org_2fa_info_1:
    - text: "Enabling organizational two-factor authentication will require users to use a password and a one-time code to log in."
  utter_enable_org_2fa_info_2:
    - text: "When enabled, each user in your organization must install an authenticator application on a compatible mobile device in order to log in."
  utter_manage_org_2fa_command:
    - custom:
        type: command
        command: manage_org_2fa
        params:
          enable_org_2fa: "{enable_org_2fa}"
          environment: "{environment}"
  utter_enable_org_2fa_success_1:
    - text: "Two-factor authentication has been enabled successfully. Users will be required to set up two-factor authentication the next time they attempt to log in."
  utter_enable_org_2fa_success_2:
    - text: "They can chat with me if they need help setting up two-factor authentication or visit [our documentation](https://access.redhat.com/documentation/en-us/red_hat_customer_portal/1/html/using_two-factor_authentication/index)."
